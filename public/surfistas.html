<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/6921956092.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/quiz.css">
    <link rel="icon" href="img/logo.png" type="image/ico">
    <title>Quiz sobre Surfistas</title>
</head>
<body>
    <div class="navbar">
        <div class="nav-items">
            <a href="index.html"><div class="logo"></div></a>
            <p class="titulo-nav"><a href="index.html">Deep<span>Blue</span></a></p>
        </div>
        <div class="nav-items2">
            <a href="index.html#sessao-historia"><p>Cultura</p></a>
            <a href="sobremim.html"><p>Sobre mim</p></a>
            <a href="quiz.html"><p>Quiz</p></a>
            <div id="icon_escondido">
                <a href="dashboard.html" class="icon-nav"><i class="fa-solid fa-circle-user icone-escondido"></i></a>
            </div>
            <div class="botoes-nav" id="botoes_nav">
                <a href="login.html"><button class="btn btn-entrar">Entrar</button></a>
                <a href="cadastro.html"><button class="btn btn-cadastro">Cadastro</button></a>
            </div>
        </div>
    </div>

    <div class="todo-conteudo-quiz">
        <div class="conteudo-quiz" id="conteudo_quiz"></div>
        <div class="botao-div">
            <button id="btn-enviar-dados" class="btn-enviar-quiz" onclick="enviarDados()">Finalizar</button>
        </div>
    </div> 

    <div class="rodape">
        <div class="sessao-rodape">
            <div class="titulo-nome">
                <p class="titulo-rodape">DeepBlue</p>
                <a class="a-rodape" href="index.html#sessao-historia"><p class="paragrafo-rodape">Cultura</p></a>
                <a class="a-rodape"  href="sobremim.html"><p class="paragrafo-rodape">História</p></a>
            </div>
            <div class="titulo-nome">
                <p class="titulo-rodape">Sites Relacionados</p>
                <a class="a-rodape" href="https://www.worldsurfleague.com/"><p class="paragrafo-rodape">WSL</p></a>
                <a class="a-rodape"  href="https://www.waves.com.br/"><p class="paragrafo-rodape">Waves</p></a>
                <a class="a-rodape"  href="https://ge.globo.com/surfe/"><p class="paragrafo-rodape">Surf ge</p></a>
            </div>
        </div>
        <div class="rodape-links">
            <div class="paragrafo-rod-item">
                <p class="paragrafo-rod">Desenvolvido por Gabriela Villegas Montero 1CCOA 2025</p>
            </div>
            <div class="icons">
                <a href="https://www.instagram.com/gabrielavmx/"><p class="icon"><i class="fa-brands fa-instagram icon fa-xl"></i></p></a>
                <a href=""><p class="icon"><i class="fa-brands fa-linkedin icon fa-xl"></i></p></a>
                <a href="https://github.com/gabrielavmxx"><p class="icon"><i class="fa-brands fa-github icon fa-xl"></i></p></a>
            </div>
        </div>
    </div>
</body>
</html>

<script>

    function VerificarConta(){
        const divBotoes = document.getElementById('botoes_nav')
        const iconEscondido = document.getElementById('icon_escondido')
        console.log(iconEscondido)

        if(sessionStorage.NOME_USUARIO == null){
            divBotoes.style.display = 'flex';
            iconEscondido.style.display = 'none'
            console.log('to aqui')
        }else{
            divBotoes.style.display = 'none';
            iconEscondido.style.display = 'block'
            console.log('funcionou!!!!!')
        }
    }
    VerificarConta()
    
    const quiz = 
    [
        {
            pergunta: "Em que estado o Gabriel Medina nasceu?",
            opcoes: 
            [
                "Rio de Janeiro",
                "São Paulo", //<- essa é a certa
                "Bahia",
                "Espírito Santo"
            ],
            questao: 1
        },
        {
            pergunta: "Quantos anos tem o Ítalo Ferreira?",
            opcoes: 
            [
                "31 anos",
                "29 anos",
                "27 anos",
                "33 anos" //<- essa é a certa
            ],
            questao: 2
        },
        {
            pergunta: "Quem foi a finalista dos jogos olímpicos de 2024?",
            opcoes: 
            [
                "Maya Gabeira",
                "Stephanie Gilmore",
                "Tatiana Weston-Webb", //<- essa é a certa
                "Silvana Lima" 
            ],
            questao: 3
        },
        {
            pergunta: "Qual surfista tem a maior quantidade de tiulos na história?",
            opcoes: 
            [
                "Kelly Slater", //<- essa é a certa
                "Gabriel Medina",
                "Tom Curren",
                "John John Florence"
            ],
            questao: 4
        },
        {
            pergunta: " Ítalo Ferreira ganhou medalha de ouro nas Olimpíadas de Tóquio em que ano?",
            opcoes: 
            [
                "2016",
                "2021", //<- essa é a certa
                "2019",
                "2024"
            ],
            questao: 5
        },
        {
            pergunta: "Qual surfista brasileiro é conhecido como 'Mineirinho'?",
            opcoes: 
            [
                "Gabriel Medina",
                "Ítalo Ferreira",
                "Yago Dora",
                "Adriano de Souza" //<- essa é a certa
            ],
            questao: 6
        },
        {
            pergunta: "Quem foi a primeira mulher brasileira a entrar no circuito mundial da WSL?",
            opcoes: 
            [
                "Tita Tavares",  //<- essa é a certa
                "Marina Werneck",
                "Silvana Lima",
                "Maya Gabeira"
            ],
            questao: 7
        },
        {
            pergunta: "Qual surfista é famoso por surfar ondas gigantes em Nazaré?",
            opcoes: 
            [
                "Mick Fanning",  
                "Filipe Toledo",
                "Maya Gabeira",//<- essa é a certa
                "Stephanie Gilmore"
            ],
            questao: 8
        },
        {
            pergunta: " John John Florence é natural de qual lugar?",
            opcoes: 
            [
                "Havaí",  //<- essa é a certa
                "Califórnia",
                "Austrália",
                "África do Sul"
            ],
            questao: 9
        }
    ]
    for(let i = 0; i < quiz.length; i++){

        if(!(i % 2 == 0)){
            conteudo_quiz.innerHTML += `
            <div class="background-cor" id="${i+1}">
                <div class="parte-cima">
                <div class="bloco-numero bloco-1"><p>${i+1}</p></div>
                <p class="perg-top">${quiz[i].pergunta}</p>
                </div>
                <div class="blocos-quiz">
                    <a href="#${i+2}" onclick="handleClick(event, 0, ${i}, this)"><p class="pergunta p1" data-opcao="0" >A)   ${quiz[i].opcoes[0]}</p></a>
                    <a href="#${i+2}" onclick="handleClick(event, 1, ${i}, this)"><p class="pergunta p1" data-opcao="1" >B)   ${quiz[i].opcoes[1]}</p></a>
                </div>
                <div class="blocos-quiz bloco-quiz-baixo">
                    <a href="#${i+2}" onclick="handleClick(event, 2, ${i}, this)"><p class="pergunta p1" data-opcao="2" >C)   ${quiz[i].opcoes[2]}</p></a>
                    <a href="#${i+2}" onclick="handleClick(event, 3, ${i}, this)"><p class="pergunta p1" data-opcao="3" >D)   ${quiz[i].opcoes[3]}</p></a>
                </div>
            </div>`

        }else{
        conteudo_quiz.innerHTML += `
        <div id="${i+1}"> 
            <div class="parte-cima">
                <div class="bloco-numero"><p>${i+1}</p></div>
                <p>${quiz[i].pergunta}</p>
            </div>
            <div class="blocos-quiz">
                <a href="#${i+2}" onclick="handleClick(event, 0, ${i}, this)"><p class="pergunta" data-opcao="0" >A)   ${quiz[i].opcoes[0]}</p></a>
                <a href="#${i+2}" onclick="handleClick(event, 1, ${i}, this)"><p class="pergunta" data-opcao="1" >B)   ${quiz[i].opcoes[1]}</p></a>
            </div>
            <div class="blocos-quiz bloco-quiz-baixo">
                <a href="#${i+2}" onclick="handleClick(event, 2, ${i}, this)"><p class="pergunta" data-opcao="2" >C)   ${quiz[i].opcoes[2]}</p></a>
                <a href="#${i+2}" onclick="handleClick(event, 3, ${i}, this)"><p class="pergunta" data-opcao="3" >D)   ${quiz[i].opcoes[3]}</p></a>
            </div>
        </div>`
        }
    }

    const respostas = []

    const corretas = 
    [
        quiz[0].opcoes[1],
        quiz[1].opcoes[0],
        quiz[2].opcoes[2],
        quiz[3].opcoes[0],
        quiz[4].opcoes[1],
        quiz[5].opcoes[3],
        quiz[6].opcoes[1],
        quiz[7].opcoes[2],
        quiz[8].opcoes[0]
    ]

    for(let i = 0; i < quiz.length; i++){
        respostas.push()
    }

    function handleClick(event, opcaoSelecionada, index, elementoClicado){
        event.preventDefault(); //nao deixa a navegacao automatica

        salvarDados(opcaoSelecionada, index, elementoClicado);

        setTimeout(() => {
            const proximoId = index + 2; 
            const proximoElemento = document.getElementById(proximoId);

            if(proximoElemento) {
                proximoElemento.scrollIntoView({ behavior: 'smooth' });
                window.location.hash = `#${proximoId}`;
            }
        }, 1000);
    }

    function salvarDados(opcaoSelecionada, index, elementoClicado){
        respostas[index] = opcaoSelecionada

        const todasOpcoes = elementoClicado.closest('div').parentElement.querySelectorAll(".pergunta")

        todasOpcoes.forEach((opcao, i)=> {
            opcao.classList.remove('correta', 'incorreta')
            if(i === opcaoSelecionada){
                if(quiz[index].opcoes[i] === corretas[index]){
                    opcao.classList.add('correta')
                } else {
                    opcao.classList.add('incorreta')
                }
            }

            if(quiz[index].opcoes[i] === corretas[index]){
                opcao.classList.add('correta')
            }
        })
    }

    function enviarDados(){
        let contador = 0
        var estaCerto
        const validacaoCorreto = []
        const numQuestao = []

        for(let i = 0; i < respostas.length; i++){
            if(quiz[i].opcoes[respostas[i]] != corretas[i]){
                estaCerto = false
            }else{
                contador++
                estaCerto = true
            }
            validacaoCorreto.push(estaCerto)
            numQuestao.push(quiz[i].questao)
        }
        
        alert('Você acertou ' + contador + ' questões')

        console.log(respostas)

        fetch("http://localhost:3333/quiz/salvarRespostas", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                "idQuizServer": "3",
                "idUsuarioServer": sessionStorage.ID_USUARIO,
                "corretoServer": validacaoCorreto,
                "numeroQuestaoServer": numQuestao,
                "resultadoServer": respostas
            })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error("Erro ao salvar as respostas")
            }
            setTimeout(() => {
                window.location.href = "dashboard.html";
            }, 1000);

        })
        .catch(error => {
            console.error("Erro ao enviar dados:", error)
            alert("Ocorreu um erro ao enviar os dados. Tente novamente.")
        })
}
</script>
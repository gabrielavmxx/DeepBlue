<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="icon" href="img/logo.png" type="image/ico">
    <script src="https://kit.fontawesome.com/6921956092.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Dashboard</title>
</head>
<body>
    <div class="navbar">
        <div class="nav-items">
            <a href="index.html"><div class="logo"></div></a>
            <p class="titulo-nav"><a href="index.html">Deep<span>Blue</span></a></p>
        </div>
        <div class="nav-items2">
            <a href="index.html#sessao-historia"><p>Cultura</p></a>
            <a href="sobremim.html"><p>Sobre mim</p></a>
            <a href="quiz.html"><p>Quiz</p></a>
            <a href="login.html"><button class="btn btn-entrar">Entrar</button></a>
            <a href="cadastro.html"><button class="btn btn-cadastro">Cadastro</button></a>
        </div>
    </div>

    <div class="conteudo-dashboard">
        <div class="items-dashboard">
            <a href="index.html"><i class="fa-solid fa-house icone"></i> <p class="p-hideen">Home</p> </a>
            <a href=""><i class="fa-solid fa-chart-pie icone"></i> <p class="p-hideen">Estatisticas</p> </a>
            <a href="quiz.html"><i class="fa-solid fa-question icone"></i> <p class="p-hideen">Quiz</p> </a>
            <a href=""><i class="fa-solid fa-user icone"></i> <p class="p-hideen">Perfil</p> </a>
            <a href=""><i class="fa-solid fa-file icone"></i> <p class="p-hideen">Meus resultados</p> </a> <!--Meus resultados-->
        </div>

        <div class="items-dashboard-inv" style="display: none;">
            <a href="index.html"><i class="fa-solid fa-house icone"></i></a>
            <a href=""><i class="fa-solid fa-chart-pie icone"></i></a>
            <a href="quiz.html"><i class="fa-solid fa-question icone"></i></a>
            <a href=""><i class="fa-solid fa-user icone"></i></a>
            <a href=""><i class="fa-solid fa-file icone"></i></a> <!--Meus resultados-->
        </div>


        <div class="graficos-dashboard">
            <canvas class="grafico g1" id="myChart1"></canvas>
            <canvas class="grafico g2" id="myChart2"></canvas>
        </div>
    </div>

    <div class="rodape">
        <div class="sessao-rodape">
            <div class="titulo-nome">
                <p class="titulo-rodape">DeepBlue</p>
                <p class="paragrafo-rodape">Lorem ipsum dolor sit amet consectetur adipisicing elit. Est laboriosam earum, cumque odit, nesciunt modi accusamus omnis voluptas minima incidunt ab tenetur rerum. Sunt iusto inventore voluptatibus, accusamus perferendis debitis?</p>
            </div>
            <div>
                <p class="titulo-rodape">Links</p>
                <p class="paragrafo-rodape">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Numquam, nostrum quas fugiat praesentium ratione ipsum. Nulla, iste praesentium accusamus voluptates velit sunt explicabo repellendus dolores expedita maiores ex eius. Deserunt.</p>
            </div>

            <div>
                <p class="titulo-rodape">Contato</p>
                <p class="paragrafo-rodape">Lorem ipsum dolor sit amet consectetur adipisicing elit. Error odit tenetur delectus quos iste voluptate ut ipsum recusandae asperiores debitis quia incidunt architecto quod praesentium, tempore dolor commodi et doloribus?</p>
            </div>
        </div>
        <div class="rodape-links">
            <p class="paragrafo-rod">Lorem ipsum dolor, sit amet consectetur adipisicing elit.</p>
            <div class="icons">
                <p class="icon"><i class="fa-brands fa-instagram icon fa-xl"></i></p>
                <p class="icon"><i class="fa-brands fa-linkedin icon fa-xl"></i></p>
                <p class="icon"><i class="fa-brands fa-github icon fa-xl"></i></p>
            </div>
        </div>
    </div>
</body>
</html>

<script>
    window.onload = async function () {
        const idUsuario = sessionStorage.ID_USUARIO;
        const idQuiz = 1; //a ou o número do quiz correspondente

        if (!idUsuario) {
            alert("Usuário não logado.");
            return;
        }

        try {
            const res = await fetch(`/dashboard/acessarTodos?idUsuarioServer=${idUsuario}&idQuizServer=${idQuiz}`);
            const dados = await res.json();

            const corretos = dados.filter(item => item.correto === 1).length;
            const incorretos = dados.length - corretos;

            const ctx1 = document.getElementById('myChart1');
            if (ctx1) {
                new Chart(ctx1, {
                    type: 'pie',
                    data: {
                        labels: ['Acertos', 'Erros'],
                        datasets: [{
                            data: [corretos, incorretos],
                            backgroundColor: ['#4CAF50', '#F44336']
                        }]
                    },
                    options: {
                        responsive: true
                    }
                });
            }
        } catch (erro) {
            console.error('Erro ao buscar dados do usuário logado:', erro);
        }

        try {
            const resTotal = await fetch(`/dashboard/acertosGerais`);
            const dadosTotal = await resTotal.json();

            const totalCorretos = dadosTotal.length;

            const ctx2 = document.getElementById('myChart2');
            if (ctx2) {
                new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: ['Total de Acertos'],
                        datasets: [{
                            label: 'Acertos no geral',
                            data: [totalCorretos],
                            backgroundColor: ['#2196F3']
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                stepSize: 1
                            }
                        }
                    }
                });
            }
        } catch (erro) {
            console.error('Erro ao buscar dados totais:', erro);
        }
    };

</script>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/6921956092.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/quiz.css">
    <link rel="icon" href="img/logo.png" type="image/ico">
    <title>Quiz de personalidade</title>
</head>
<body>
    <div class="navbar">
        <div class="nav-items">
            <a href="index.html"><div class="logo"></div></a>
            <p class="titulo-nav"><a href="index.html">Deep<span>Blue</span></a></p>
        </div>
        <div class="nav-items2">
            <a href="index.html#sessao-historia"><p>Cultura</p></a>
            <a href="sobremim.html"><p>Sobre mim</p></a>
            <a href="quiz.html"><p>Quiz</p></a>
            <div id="icon_escondido">
                <a href="dashboard.html" class="icon-nav"><i class="fa-solid fa-circle-user icone-escondido"></i></a>
            </div>
            <div class="botoes-nav" id="botoes_nav">
                <a href="login.html"><button class="btn btn-entrar">Entrar</button></a>
                <a href="cadastro.html"><button class="btn btn-cadastro">Cadastro</button></a>
            </div>
        </div>
    </div>

    <div class="todo-conteudo-quiz">
        <div class="conteudo-quiz" id="conteudo_quiz"></div>
        <div class="botao-div">
            <button id="btn-enviar-dados" class="btn-enviar-quiz" onclick="enviarDados()">Finalizar</button>
        </div>
    </div> 

    <div id="div_resultado">
    </div>

    <div class="rodape">
        <div class="sessao-rodape">
            <div class="titulo-nome">
                <p class="titulo-rodape">DeepBlue</p>
                <a class="a-rodape" href="index.html#sessao-historia"><p class="paragrafo-rodape">Cultura</p></a>
                <a class="a-rodape"  href="sobremim.html"><p class="paragrafo-rodape">Hist√≥ria</p></a>
            </div>
            <div class="titulo-nome">
                <p class="titulo-rodape">Sites Relacionados</p>
                <a class="a-rodape" href="https://www.worldsurfleague.com/"><p class="paragrafo-rodape">WSL</p></a>
                <a class="a-rodape"  href="https://www.waves.com.br/"><p class="paragrafo-rodape">Waves</p></a>
                <a class="a-rodape"  href="https://ge.globo.com/surfe/"><p class="paragrafo-rodape">Surf ge</p></a>
            </div>
        </div>
        <div class="rodape-links">
            <div class="paragrafo-rod-item">
                <p class="paragrafo-rod">Desenvolvido por Gabriela Villegas Montero 1CCOA 2025</p>
            </div>
            <div class="icons">
                <a href="https://www.instagram.com/gabrielavmx/"><p class="icon"><i class="fa-brands fa-instagram icon fa-xl"></i></p></a>
                <a href=""><p class="icon"><i class="fa-brands fa-linkedin icon fa-xl"></i></p></a>
                <a href="https://github.com/gabrielavmxx"><p class="icon"><i class="fa-brands fa-github icon fa-xl"></i></p></a>
            </div>
        </div>
    </div>
</body>
</html>

<script>

    function VerificarConta(){
        const divBotoes = document.getElementById('botoes_nav')
        const iconEscondido = document.getElementById('icon_escondido')
        console.log(iconEscondido)

        if(sessionStorage.NOME_USUARIO == null){
            divBotoes.style.display = 'flex';
            iconEscondido.style.display = 'none'
            console.log('to aqui')
        }else{
            divBotoes.style.display = 'none';
            iconEscondido.style.display = 'block'
            console.log('funcionou!!!!!')
        }
    }
    VerificarConta()

    const quiz = 
    [
        {
            pergunta: "Com base na sua personalidade, voc√™ se considera..",
            opcoes: 
            [
            "Confiante",
            "Esfor√ßado(a)",
            "Curioso(a)",
            "Engra√ßado(a)"
            ],
            questao: 1
        },
        {
            pergunta: "Escolha o defeito que voc√™ mais se identifica..",
            opcoes: 
            [
            "Teimoso(a)",
            "Pregui√ßoso(a)",
            "Irritado(a)",
            "Procrastinador(a)"
            ],
            questao: 2
        },
        {
            pergunta: "Qual dessas op√ß√µes voc√™ prefere?",
            opcoes: 
            [
            "Queijo coalho no espeto",
            "An√©is de cebola frito",
            "Milho verde",
            "Frutas"
            ],
            questao: 3
        },
        {
            pergunta: "Escolha o melhor tipo de onda..",
            opcoes: 
            [
            "Tubos",
            "Fechadeira",
            "Cavada",
            "Espuma"
            ],
            questao: 4
        },
        {
            pergunta: "Voc√™ costuma se arriscar?",
            opcoes: 
            [
            "N√£o muito, s√≥ o b√°sico",
            "Prefiro n√£o me arriscar nadinha",
            "Sempre tento ter o m√°ximo de proveito nas ondas",
            "Sempreüòé"
            ],
            questao: 5
        },
        {
            pergunta: "Que tipo de prancha voc√™ prefere?",
            opcoes: 
            [
            "LongBoard",
            "Stand Up paddle",
            "ShortBoard",
            "Body"
            ],
            questao: 6
        },
        {
            pergunta: "Qual desses surfistas √© o seu favorito?",
            opcoes: 
            [
            "Gabriel Medina",
            "Italo Ferreira",
            "Tatiana Weston-Webb",
            "Yago Dora"
            ],
            questao: 7
        }
    ]

    const mapaPersonagemID = {
    "Jo√£o Frango": "A",
    "Barbie Surfista": "B",
    "Cadu Maverick": "C",
    "Lilo": "E",
    "Stitch": "F",
    "JJ Maybank": "G",
    "Lani Aliikai": "H",
    "Kiara Carrera": "I"
    };

    const pesos = {
    questao1: {
        a: {"Kiara Carrera": 60, "Cadu Maverick": 30},
        b: {"Barbie Surfista": 80, "JJ Maybank": 60, "Lani Aliikai": 50},
        c: {"Lilo": 80, "Stitch": 60},
        d: {"Jo√£o Frango": 80, "JJ Maybank": 60}
    },
    questao2: {
        a: {"Kiara Carrera": 50, "Stitch": 40},
        b: {"Jo√£o Frango": 60, "Cadu Maverick": 50},
        c: {"JJ Maybank": 70, "Barbie Surfista": 40},
        d: {"Lilo": 60}
    },
    questao3: {
        a: {"Barbie Surfista": 60, "Lani Aliikai": 40},
        b: {"Stitch": 70, "JJ Maybank": 40},
        c: {"Cadu Maverick": 40},
        d: {"Lilo": 80, "Jo√£o Frango": 40}
    },
    questao4: {
        a: {"Cadu Maverick": 70, "Kiara Carrera": 40},
        b: {"Stitch": 60, "Jo√£o Frango": 50},
        c: {"JJ Maybank": 40},
        d: {"Lilo": 70, "Barbie Surfista": 50}
    },
    questao5: {
        a: {"Lani Aliikai": 70, "Barbie Surfista": 50},
        b: {"Jo√£o Frango": 70, "Lilo": 50},
        c: {"JJ Maybank": 50},
        d: {"Stitch": 80, "Cadu Maverick": 60}
    },
    questao6: {
        a: {"Barbie Surfista": 70, "Cadu Maverick": 60},
        b: {"Jo√£o Frango": 60, "Lilo": 50},
        c: {"JJ Maybank": 60},
        d: {"Stitch": 70, "Kiara Carrera": 40}
    },
    questao7: {
        a: {"JJ Maybank": 50},
        b: {"Cadu Maverick": 70, "Stitch": 50},
        c: {"Barbie Surfista": 70, "Lani Aliikai": 60},
        d: {"Kiara Carrera": 80, "Jo√£o Frango": 50}
    }
}

    for(let i = 0; i < quiz.length; i++){

        if(!(i % 2 == 0)){
            conteudo_quiz.innerHTML += `
            <div class="background-cor" id="${i+1}">
                <div class="parte-cima">
                <div class="bloco-numero bloco-1"><p>${i+1}</p></div>
                <p class="perg-top">${quiz[i].pergunta}</p>
                </div>
                <div class="blocos-quiz">
                    <a href="#${i+2}" onclick="salvarDados('a', ${i})"><p class="pergunta p1">A)   ${quiz[i].opcoes[0]}</p></a>
                    <a href="#${i+2}" onclick="salvarDados('b', ${i})"><p class="pergunta p1">B)   ${quiz[i].opcoes[1]}</p></a>
                </div>
                <div class="blocos-quiz bloco-quiz-baixo">
                    <a href="#${i+2}" onclick="salvarDados('c', ${i})"><p class="pergunta p1">C)   ${quiz[i].opcoes[2]}</p></a>
                    <a href="#${i+2}" onclick="salvarDados('d', ${i})"><p class="pergunta p1">D)   ${quiz[i].opcoes[3]}</p></a>
                </div>
            </div>`

        }else{
        conteudo_quiz.innerHTML += `
        <div id="${i+1}"> 
            <div class="parte-cima">
                <div class="bloco-numero"><p>${i+1}</p></div>
                <p>${quiz[i].pergunta}</p>
            </div>
            <div class="blocos-quiz">
                <a href="#${i+2}" onclick="salvarDados('a', ${i})"><p class="pergunta">A)   ${quiz[i].opcoes[0]}</p></a>
                <a href="#${i+2}" onclick="salvarDados('b', ${i})"><p class="pergunta">B)   ${quiz[i].opcoes[1]}</p></a>
            </div>
            <div class="blocos-quiz bloco-quiz-baixo">
                <a href="#${i+2}" onclick="salvarDados('c', ${i})"><p class="pergunta">C)   ${quiz[i].opcoes[2]}</p></a>
                <a href="#${i+2}" onclick="salvarDados('d', ${i})"><p class="pergunta">D)   ${quiz[i].opcoes[3]}</p></a>
            </div>
        </div>`
        }
    }

function calcularPersonagem(respostas) {
    const pontuacao = {}

    for (let i = 0; i < respostas.length; i++) {
        const resposta = respostas[i]
        const numeroQuestao = i + 1
        const chaveQuestao = `questao${numeroQuestao}`
        //o ? serve para evitar erro se a chaveQuestao estiver nula
        //inves de retornar um erro ele retorna undefined
        const pesoOpcao = pesos[chaveQuestao]?.[resposta]

        //Se pesoOpcao for true
        if (pesoOpcao) {

            // let chaves = Object.keys(pesoOpcao);
            // for (let i = 0; i < chaves.length; i++) {
            // let personagem = chaves[i];
            // let valor = pesoOpcao[personagem];
            // }
            
            for (const personagem in pesoOpcao) {
                //caso exista uma pontua√ß√£o use ela *****ou**** se n√£o houver use 0 e depois pegue o peso e some
                pontuacao[personagem] = (pontuacao[personagem] || 0) + pesoOpcao[personagem]
            }
        }
    }

    let maiorPontuacao = -Infinity;
    let personagensEmpatados = [];

    for (const personagem in pontuacao) {
        if (pontuacao[personagem] > maiorPontuacao) {
            maiorPontuacao = pontuacao[personagem];
            personagensEmpatados = [personagem];
        } else if (pontuacao[personagem] === maiorPontuacao) {
            personagensEmpatados.push(personagem);
        }
    }

    // Se tiver mais de um personagem com a maior pontua√ß√£o, sorteia um
    if (personagensEmpatados.length > 1) {
        const sorteadoIndex = Math.floor(Math.random() * personagensEmpatados.length);
        return personagensEmpatados[sorteadoIndex];
    } else {
        return personagensEmpatados[0] || null;
    }
}

//biblioteca js para confeti

var jq = document.createElement('script');
jq.src = "https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js";
document.getElementsByTagName('head')[0].appendChild(jq);
function frame() {
  //confeti do lado esquerdo
  confetti({
    particleCount: 135,
    angle: 60,
    spread: 200,
    origin: {
      x: 0 }
  }
          );
  // confeti lado direito
  confetti({
    particleCount: 135,
    angle: 120,
    spread: 55,
    origin: {
      x: 1 }
  }
          );
}
var f =  document.getElementsByClassName('btn-enviar-quiz')[0]
f.onclick = function(){
    setTimeout(function(){
            frame();
            telaEscondida()
    }, 800); 
} 



function telaEscondida(){
    const personagemFinal = calcularPersonagem(respostas);
    const container = document.getElementById('div_resultado');
    container.style.display = 'block';
    var imagem = null
    var mensagem = null

    if (personagemFinal == 'Jo√£o Frango'){
        imagem = "<img src='./img/joaoFrango.jpeg' />"
        mensagem = "Voc√™ √© aquela pessoa que pode parecer t√≠mida √† primeira vista, mas tem uma coragem surpreendente guardada dentro de si. Sempre pronto(a) para ajudar os outros, voc√™ √© leal, carism√°tico(a) e sabe se adaptar nas situa√ß√µes mais malucas. Seu jeitinho atrapalhado s√≥ te deixa ainda mais aut√™ntico(a)!"
    }else if(personagemFinal == 'Barbie Surfista'){
        imagem = "<img src='./img/barbieSurfista.jpg' />"
        mensagem = "Voc√™ √© confiante, determinada e tem um esp√≠rito leve que inspira todo mundo ao seu redor. N√£o tem medo de se jogar em novas aventuras e vive com estilo. Voc√™ equilibra bem o lado competitivo com o amor pela natureza e sempre espalha boas vibra√ß√µes por onde passa!"
    }else if(personagemFinal == 'Cadu Maverick'){
        imagem = "<img src='./img/cadu.jpeg' />"
        mensagem = "Voc√™ tem alma de aventureiro(a)! Sempre buscando o seu lugar no mundo, voc√™ n√£o tem medo de correr riscos e seguir seu cora√ß√£o. Aut√™ntico(a), resiliente e sonhador(a), voc√™ valoriza a amizade verdadeira e √© movido(a) pela paix√£o em tudo que faz."
    }else if(personagemFinal == 'Lilo'){
        imagem = "<img src='./img/liloestich.jpg' />"
        mensagem = "Voc√™ √© sens√≠vel, criativa e tem um cora√ß√£o enorme. Mesmo quando o mundo parece complicado, voc√™ se mant√©m fiel a quem voc√™ √©. Valoriza muito sua fam√≠lia (ohana!) e sempre enxerga o melhor nas pessoas ‚Äî mesmo nas mais estranhas. üíô"
    }else if(personagemFinal == 'Stitch'){
        imagem = "<img src='./img/liloestich.jpg' />"
        mensagem = "Voc√™ tem uma energia intensa e um esp√≠rito livre que nem sempre segue as regras. Mas por tr√°s do seu jeito bagunceiro, existe um cora√ß√£o enorme e um desejo sincero de pertencer. Leal, engra√ßado e √∫nico(a), voc√™ prova que at√© os mais ca√≥ticos podem amar e ser amados."
    }else if(personagemFinal == 'JJ Maybank'){
        imagem = "<img src='./img/jjmaybank.jpeg' />"
        mensagem = "Voc√™ √© ousado(a), impulsivo(a) e vive no limite ‚Äî mas com um cora√ß√£o de ouro. Costuma agir antes de pensar, mas est√° sempre l√° pelos seus amigos, n√£o importa o que aconte√ßa. Voc√™ √© aquele(a) que traz a adrenalina pro grupo e defende com unhas e dentes quem ama."
    }else if(personagemFinal == 'Lani Aliikai'){
        imagem = "<img src='./img/lanialiikai.jpeg' />"
        mensagem = "Voc√™ √© equilibrado(a), maduro(a) e tem um esp√≠rito acolhedor. Sabe dar bons conselhos, curte a vibe tranquila da praia e valoriza relacionamentos sinceros. Pode parecer reservado(a) √†s vezes, mas sua calma e firmeza s√£o sua for√ßa. Voc√™ √© o ponto de paz no meio do caos."
    }else if(personagemFinal == 'Kiara Carrera'){
        imagem = "<img src='./img/kiaraCarrera.jpeg' />"
        mensagem = "Voc√™ √© determinada, cheia de atitude e tem um senso de justi√ßa afiado. Gosta de fazer o que acredita ser certo, mesmo que isso signifique ir contra a mar√©. Independente, forte e com o cora√ß√£o enorme, voc√™ luta por aquilo que acredita e est√° sempre pronta pra agir."
    }

    div_resultado.innerHTML += `
    <div class="container-invisivel">
        <div>
            <p class="paragrafo-branco">Voc√™ √© o(a): ${personagemFinal}</p>
        </div>
        <div class="cont-result">
            <div class="imagem-resultado-quiz">${imagem}</div>
            <p class="mensagem-paragrafo">${mensagem}</p>
        </div>
    </div>
    `
}

    const respostas = []

    for(let i = 0; i < quiz.length; i++){
        respostas.push(null)
    }

    function salvarDados(resposta, index){
        respostas[index] = resposta
    }

    function enviarDados(){
        const personagemFinal = calcularPersonagem(respostas);
        const personagemID = mapaPersonagemID[personagemFinal];

        console.log("Respostas:", respostas);
        console.log("Personagem:", personagemFinal);
        console.log("ID enviado:", personagemID);


        console.log(respostas)
        fetch("http://localhost:3333/quiz/salvarRespostas", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            "idQuizServer": "1",
            "idUsuarioServer": sessionStorage.ID_USUARIO,
            "corretoServer": [],
            "corretoServer": [],
            "numeroQuestaoServer": [],
            "resultadoServer": personagemID
        }),
    })
    }
</script>